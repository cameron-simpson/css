#!/bin/sh
#
# Read a mail folder with mutt.
#	- Cameron Simpson <cs@zip.com.au>
#

cmd=$0
usage="Usage: $0 [-f] [+a] [some-mutt-options...] [mutt-folder]"

mfolder=+attn
muttopts=
anyhost=

badopts=
while :
do
  case $1 in
    +a)		termopts="$termopts $1" ;;
    -f)		anyhost=1 ;;
    -[nR])	muttopts="$muttopts $1" ;;
    -[em])	muttopts="$muttopts $1 "`shqstr "$2"`; shift ;;
    --)		shift; break ;;
    -?*)	echo "$cmd: unrecognised option: $1" >&2; badopts=1 ;;
    *)		break ;;
  esac
  shift
done

if [ $# -gt 0 ]
then
  case $1 in
    /*)		mfolder=$1 ;;
    +*)		mfolder=$1 ;;
    imap:*)	mfolder=$1 anyhost=1 ;;
    *.*)	mfolder=nntp://$NNTPSERVER/$1 anyhost=1 ;;
    *)		mfolder=+$1 ;;
  esac
  shift
  [ $# = 0 ] || { echo "$cmd: extra arguments: $*" >&2; badopts=1; }
fi

[ $badopts ] && { echo "$usage" >&2; exit 2; }

[ $anyhost ] || needhost "$HOMEHOST@$SYSTEMID" || exit 1

cd || exit 1
[ -s "$HOME/rc/mail/muttsh.$mfolder" ] && . "$HOME/rc/mail/muttsh.$mfolder"
export mfolder
set -x
exec \
	term $termopts +ip -n "mutt $mfolder" \
	sh -c "set -x; exec mutt -f \"\$mfolder\" $muttopts"
##scr "mutt_$mfolder" \
