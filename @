#!/bin/sh
#
# Open fresh shell on target machine in new window.
#	- Cameron Simpson <cs@zip.com.au> 23oct2001
#

cmd=$0
usage="Usage: $cmd [host,host... [rterm-args...]]"

badopts=

[ $badopts ] && { echo "$usage" >&2; exit 2; }

at_dflt=
at_target=

if [ $# -gt 0 ]
then
  host=$1
  shift
else
  # no hosts? try for default list of targets
  at_default=
  eval `winclause "$HOME/rc/@" "$HOST.$SYSTEMID@$LOCATION" | sed -n 's/^default=/at_&/p'`
  if [ -n "$at_default" ]
  then host=$at_default
  else echo "$0: no default host list for $HOST.$SYSTEMID@$LOCATION" >&2
	exit 1
  fi
fi

# transmute some names
at_target=
eval `winclause "$HOME/rc/@" "$host" | sed -n 's/^target=/at_&/p'`
[ -n "$at_target" ] && host=$at_target

case "$host" in
  *,*)
      [ -n "$DISPLAY" ] || { echo "$cmd: can't do multiple sessions without a \$DISPLAY" >&2
			     exit 1
			   }
      xit=0

      lastbase=
      for h in `echo "$host" | tr , ' '`
      do  case "$h" in
	    [0-9])
	      [ -n "$lastbase" ] \
	      || { echo "$cmd: no previous hostN name, skipping: $h" >&2
		   xit=1
		   continue
		 }
	      h=$lastbase$h
	      ;;
	    [a-z]*[0-9])
	      lastbase=`expr "x$h" : 'x\(.*[^0-9]\)[0-9]*'` || xit=1
	      ;;
	  esac
	  "$0" "$h" ${1+"$@"} || xit=1
      done
      exit $xit
      ;;
  root@*)
      exec root@ "$host" ${1+"$@"}
      ;;
  *)  exec rterm "$host" ${1+"$@"}
      ;;
esac
