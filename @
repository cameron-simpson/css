#!/bin/sh
#
# Open fresh shell on target machine in new window.
#	- Cameron Simpson <cs@zip.com.au> 23oct2001
#

cmd=$0
usage="Usage: $cmd [-X] [hosts...]"

badopts=

sshopts=

while :
do  case $1 in
      -X)	sshopts="$sshopts $1" ;;
      --)	shift; break ;;
      -?*)	echo "$cmd: unrecognised option: $1" >&2
		badopts=1
		;;
      *)	break ;;
    esac
    shift
done

[ $badopts ] && { echo "$usage" >&2; exit 2; }

at_dflt=
at_target=

if [ $# = 0 ]
then
  at_default=
  eval `winclause "$HOME/rc/@" "$HOST@$SYSTEMID" | sed -n 's/^default=/at_&/p'`
  if [ -n "$at_default" ]
  then set $at_default
  else echo "$0: no default host list for $HOST@$SYSTEMID" >&2
	exit 1
  fi
fi

for host
do
  # transmute some names
  at_target=
  eval `winclause "$HOME/rc/@" "$host" | sed -n 's/^target=/at_&/p'`
  [ -n "$at_target" ] && host=$at_target

  case "$host" in
    *,*)
	[ -n "$DISPLAY" ] || { echo "$cmd: can't do multiple sessions without a \$DISPLAY" >&2
			       exit 1
			     }
	for h in `echo "$host" | tr , ' '`
	do  "$0" $sshopts "$h"
	done
	exit 0
	;;
    root@*)
	exec root@ $sshopts "$host"
	;;
    screen:root@*)
	name=`expr "$host" : 'screen:\(.*\)'`
	host=`expr "$name" : 'root@\(.*\)'`
	exec term -e scr "$name" nox root@ $sshopts "$host"
	;;
    screen:*)
	host=`expr "$host" : 'screen:\(.*\)'`
	exec rterm "$host" -s $sshopts
	;;
    rita)
	set -x
	rdesktop -g "${X11_BGX}x${X11_Y}" -K -T "$host rdesktop" "$host" &
	;;
    *)	exec rterm "$host" $sshopts
	;;
  esac
done
