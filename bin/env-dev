#!/bin/sh -ue
#
# Run command in development environment.
# This means using the current directory as $prefix,
# prefixing lots of $fooPATH vars with it approriately,
# sourcing .env.sh if present, then running command.
#       - Cameron Simpson <cs@zip.com.au> 25apr2007
#

set -ue

trace=${DEBUG:+set-x}

devdir=.

cmd=`basename "$0"`
usage="Usage: $cmd [-d develdir] [-x] [command [args...]]
        -d develdir     Development source dir. Default: current directory.
        -x              Trace invocation of command."

badopts=

while [ $# -gt 0 ]
do
  case $1 in
    -d) devdir=$2; shift ;;
    -x) trace=set-x ;;
    --) shift; break ;;
    -?*)echo "$cmd: unrecognised option: $1" >&2
        badopts=1
        ;;
    *)  break ;;
  esac
  shift
done

[ -d "$devdir/." ] || { echo "$cmd: not a directory: $devdir" >&2
                        badopts=1
                      }

[ $badopts ] && { echo "$usage" >&2; exit 2; }

case "$devdir" in /*) ;; *) devdir=`cd "$devdir" && pwd` ;; esac

PYTHONPATH=$devdir/lib/python:$devdir/lib:$PYTHONPATH
PERL5LIB=$devdir/lib/perl5:$devdir/lib:$PERL5LIB
MANPATH=$devdir/man:$MANPATH
LD_LIBRARY_PATH=$devdir/lib${LD_LIBRARY_PATH:+:$LD_LIBRARY_PATH}
PATH=$devdir/bin:$PATH
export PYTHONPATH PERL5LIB MANPATH LD_LIBRARY_PATH PATH
[ ! -f "$devdir/.env.sh" ] || . "$devdir/.env.sh"

if [ $# = 0 ]
then
  env | sort
  exit
fi

exec $trace "$@"
