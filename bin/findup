#!/bin/sh
#
# Look for a relative path in all directories from the current one upward.
#   - Cameron Simpson <cs@zip.com.au> 04may2016
# 

set -ue

cmd=$( basename "$0" )
usage="Usage: [-a] relpath [testcmd]"

all=

badopts=

while [ $# -gt 0 ]
do
  case $1 in
    -a) all=1 ;;
    --) shift; break ;;
    -?*)echo "$cmd: unrecognised option: $1" >&2
        badopts=1
        ;;
    *)  break ;;
  esac
  shift
done

if [ $# = 0 ]
then
  echo "$cmd: missing relpath" >&2
  badopts=1
else
  relpath=$1
  shift
fi

# default test: path exists
[ $# -gt 0 ] || set -- test -e

xit=1

odir=
dir=$( pwd )
while [ -z "$odir" ] || [ "x$odir" != "x$dir" ]
do
  path=$dir/$relpath
  if "$@" "$relpath"
  then
    xit=0
    printf '%s\n' "$path"
    [ $all ] || break
  fi
  odir=$dir
  dir=$( dirname "$dir" )
done

exit $xit
