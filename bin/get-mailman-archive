#!/bin/sh -ue
#
# Download mailman archive into a UNIX mbox file.
#       - Cameron Simpson <cs@zip.com.au> 19jan2009
#

[ $# -gt 0 ] || { echo "Usage: $0 archive-page-url >mlist.mbox" >&2; exit 2; }

trace=set-x

for url
do
  pageurls "$url" \
  | grep '\.gz$' \
  | while read gzurl
    do
      $trace wget -O - "$gzurl" | gunzip
    done
done \
| fix-mail-dates --mbox \
| un-at-
