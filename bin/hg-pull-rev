#!/bin/sh
#
# Pull a specific revisions from a different checkout.
# Initial use case is to pull bugfixes from an as yet unpublished
# branch, still lurking in an isolated checkout.
#   - Cameron Simpson <cs@zip.com.au> 30jan2015
#

set -ue

trace=
[ -t 2 ] && trace=set-x

cmd=$(basename "$0")
usage="Usage: $cmd other-checkout rev...
  other-checkout
    Directory containing the other checkout.
  rev
    Revision identifiers from other-checkout."

badopts=

if [ $# = 0 ]
then
  echo "$cmd: missing other-checkout" >&2
  badopts=1
else
  ocheckout=$1
  shift
  if [ ! -d "$ocheckout/." ]
  then
    echo "$cmd: other-checkout not a directory: $ocheckout" >&2
    badopts=1
  fi
fi

if [ $# = 0 ]
then
  echo "$cmd: missing revs" >&2
  badopts=1
fi

[ $badopts ] && { echo "$usage" >&2; exit 2; }

for rev
do
  $trace incd "$ocheckout" hg export "$rev" \
  | $trace hg import --import-branch -
done
