#!/bin/sh
#

set -ue

hosts=/etc/hosts
sfx=.l

cmd=$0
usage="Usage: $cmd [hostsfile] <hosts"

badopts=

if [ $# -gt 0 ]
then
  hosts=$1
  shift
fi

[ -s "$hosts" ] || { echo "$cmd: expected nonempty regular file: $hosts" >&2
                     badopts=1
                   }

if [ $# -gt 0 ]
then
  echo "$cmd: extra arguments: $*" >&2
  badopts=1
fi

[ $badopts ] && { echo "$usage" >&2; exit 2; }

n=2
while read names
do
  case "$names" in
    '' | \#* )
      echo "$names"
      continue
      ;;
  esac
  printf "127.0.0.%d" "$n"
  n=$(expr $n + 1)
  for name in $names
  do  printf " $name$sfx"
  done
  echo
done \
| rlr -f "^## BEGIN LOCAL ADDRS" -t "^## END LOCAL ADDRS" -i "$hosts" -o "$hosts" -
