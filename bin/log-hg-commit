#!/bin/sh -ue
#
# Record a Mercurial commit.
#       - Cameron Simpson <cs@zip.com.au> 25apr2007
#

hg log -r "$HG_NODE" --limit 1 \
| sed '1,/^description:/d; s/\t/ /g; s/\r$//; /^ *$/d' \
| { read -r headline
    if [ -n .hg-cs-category ]
    then
      cat=`cat .hg-cs-category`
      wd=`pwd`
      wdbase=`basename "$wd"`
      dlog "$cat: $wdbase: $headline" </dev/null
    fi
    exec buglog "commit $HG_NODE: $headline"
  }
