#!/bin/sh -u
#
# Return a subpath based of a file's MD5 checksum of the form:
#	xx/xxxx.....
# Used to construct content-based cache directories.
# - Cameron Simpson <cs@zip.com.au> 18may2005
#

cmd=$0
usage="Usage: $cmd [filename|-]"

[ $# = 1 ] || { echo "$usage" >&2; exit 2; }

case "$1" in
  -?*)	file=./$1 ;;
  *)	file=$1 ;;
esac

md5path=`md5sum -b -- "$file" | sed 's;\(..\)\([^ ]*\) .*;\1/\2;'`
[ -n "$md5path" ] || { echo "$cmd: can't checksum $file" >&2; exit 1; }
printf '%s\n' "$md5path"
