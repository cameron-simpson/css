#!/bin/sh -ue
#
# Connect to default MySQL database.
#	- Cameron Simpson <cs@zip.com.au>
#

cmd=`basename "$0"`
usage="Usage: $cmd [-x] [@where] [dbname]"

PATH=$PATH:/usr/local/mysql/bin
export PATH

trace=
secret=mysql-root@$SYSTEMID
db=

badopts=

while [ $# -gt 0 ]
do
  case $1 in
    -x) trace=set-x ;;
    --) shift; break ;;
    -?*)echo "$cmd: unrecognised option: $1" >&2
        badopts=1
        ;;
    *)  break ;;
  esac
  shift
done

if [ $# -gt 0 ]
then
  case $1 in
    /*) secret=$1; shift ;;
    @*) secret=mysql-root$1; shift ;;
    *@*)secret=mysql-$1; shift ;;
  esac
fi

if [ $# -gt 0 ]
then
  case $1 in
    [a-zA-Z]*)
      db=$1; shift ;;
  esac
fi

if [ $# -gt 0 ]
then
  echo "$cmd: extra arguments: $*" >&2
  badopts=1
fi

[ $badopts ] && { echo "$usage" >&2; exit 2; }

secret=`secret "$secret"` || exit 1
eval "$secret" || exit 1
exec $trace mysql "-h$secretHOST" "-u$secretLOGIN" "-p$secretPASSWORD" $db
