#!/bin/sh -u
#
# Push my account to other places.
#	- Cameron Simpson <cs@zip.com.au>
#

cmd=`basename "$0"` || cmd=$0
usage="Usage: $cmd [-s] [-f] [login@]hostname[/subpath]..."

hARCH=$ARCH

force=
async=1

badopts=

while [ $# -gt 0 ]
do
  case $1 in
    -f)	force=1 ;;
    -s)	async= ;;
    --)	shift; break ;;
    -?*)echo "$cmd: unrecognised option: $1" >&2
	badopts=1
	;;
    *)	break ;;
  esac
  shift
done

[ $# = 0 ] && { echo "$cmd: missing login@hostname" >&2
		badopts=1
	      }

[ $badopts ] && { echo "$usage" >&2; exit 2; }

[ $force ] || needhost $HOMEHOST@home || exit 1

cd || exit 1
for host
do
  pfx="$cmd $host"
  case "$host" in
    */?*)
      subpath=`expr "x$host" : 'x[^/]*/\(..*\)'`/
      host=`expr "x$host" : 'x\([^/]*\)/..*'`
      ;;
    *)subpath=
      ;;
  esac
  pfx "$cmd $host" syncacc '' "$host:$subpath" &
  [ $async ] || wait
done
wait
