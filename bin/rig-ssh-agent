#!/bin/sh
#
# Ensure we have an ssh agent, setting up a per-host ssh-agent in daemon mode if needed.
# Emit $SSH_AUTH_SOCK to stdout.
#	- Cameron Simpson <cs@zip.com.au> 30jul2001
#

set -ue

statefile=$HOME/var/run/ssh-agent-$HOST

# test for existing ssh-agent
ssh-add -l >/dev/null || [ $? = 1 ] \
|| [ -s "$statefile" ] && . "$statefile" && { ssh-add -l >/dev/null || [ $? = 1 ]; } \
|| eval `ssh-agent -s | tee "$statefile"`

echo "$SSH_AUTH_SOCK"
