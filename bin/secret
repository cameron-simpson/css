#!/usr/bin/env python25
#
# Fetch or secrete a secret.
#	- Cameron Simpson <cs@zip.com.au> 09nov1999
#
# Python port for better secret name syntax. - cameron 18mar2008
#

import sys
import cs.secret
import cs.sh
from cs.misc import cmd, cmderr

usage="Usage: %s [key [field=value]...]" % cmd

args=sys.argv[1:]
if  len(args) == 0:
  for secret in cs.secret.list():
    print secret
  sys.exit(0)

secret=args.pop(0)

if len(args) == 0:
  S=cs.secret.get(secret)
  ks=S.keys()
  ks.sort()
  sep=''
  for k in ks:
    sys.stdout.write("%ssecret%s=%s" % (sep, k, cs.sh.quotestr(S[k])))
    sep='; '
  sys.stdout.write("\n")
  sys.stdout.flush()
  sys.exit(0)

cmderr("setting secret values not implemented")
sys.exit(1)
