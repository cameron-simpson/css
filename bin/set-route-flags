#!/bin/sh
#
# Probe "netstat -rn" routes, set flags accordingly.
#   - Cameron Simpson <cs@zip.com.au> 02feb2015
#

set -ue

trace=
[ -t 2 ] && trace=set-x

set -- $( get-default-gateway )
if [ $# = 0 ]
then  $trace flag ROUTE_DEFAULT 0
else  $trace flag ROUTE_DEFAULT 1
fi

for gw
do
  echo "$gw"
done | tr . _  | flagset ROUTE_GW set-all

netstat -rn \
| sed -n '/^Internet:/,/^$/{ /^[1-9][^ ]* /!d; s/ .*//; y/./_/; s|/|__|; p; }' \
| flagset ROUTE_TO set-all
