#!/bin/sh
#
# Convenience wrapper for VirtualBox command line tools.
#   - Cameron Simpson <cs@zip.com.au> 06may2016
#

set -ue

cmd=$( basename "$0" )
usage="Usage: $cmd op [arguments...]
  Operations:
    pause vm-name [VBoxManage controlvm vm-name pause options...]
    resume vm-name [VBoxManage controlvm vm-name resume options...]
    start vm-name [VBoxManage startvm options...]
    suspend vm-name [VBoxManage controlvm vm-name savestate options...]"

badopts=

if [ $# = 0 ]
then
  echo "$cmd: missing op" >&2
  badopts=1
else
  op=$1
  shift
  case "$op" in
    pause|resume|start|suspend)
        if [ $# = 0 ]
        then
          echo "$cmd: $op: missing vm-name" >&2
          badopts=1
        else
          vmname=$1
          shift
        fi
        ;;
    *)  echo "$cmd: unrecognised op: $op" >&2
        badopts=1
        ;;
  esac
fi

[ $badopts ] && { echo "$usage" >&2; exit 2; }

case "$op" in
  pause)    VBoxManage controlvm "$vmname" pause ${1+"$@"} ;;
  resume)   VBoxManage controlvm "$vmname" resume ${1+"$@"} ;;
  start)    VBoxManage startvm "$vmname" ${1+"$@"} ;;
  suspend)  VBoxManage controlvm "$vmname" savestate ${1+"$@"} ;;
  *)        echo "$cmd: unimplemented op: $op" >&2
            exit 1
            ;;
esac
