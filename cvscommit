#!/bin/sh -u
#
# Commit changes, using commit-editor to make the log more helpful to its
# author. - Cameron Simpson <cs@zip.com.au> 12apr1997
#

cmd=$0
usage="Usage: $cmd [files...]"

: ${TMPDIR:=/tmp}
: ${EDITOR:=vi}

CVS_COMMIT_DIFFS=$TMPDIR/cvd$$
CVS_COMMIT_EDITOR=$EDITOR
CVS_COMMIT_FILES=$*
EDITOR=$0-editor
export EDITOR CVS_COMMIT_EDITOR CVS_COMMIT_DIFFS CVS_COMMIT_FILES

trap 'rm -f "$CVS_COMMIT_DIFFS"' 0 1 2 13 15

cvs -q diff ${1+"$@"} >"$CVS_COMMIT_DIFFS"

egrep '^(-|\+)' "$CVS_COMMIT_DIFFS" >/dev/null \
|| \
{ echo "No diffs. Listing named files."
  echo "Filenames: $*"
  echo
  grep -r . /dev/null ${1+"$@"}
} >>"$CVS_COMMIT_DIFFS"


cvs commit -l ${1+"$@"}

exit $?
