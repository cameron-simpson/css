#!/bin/sh
#
# Set the root background on per-desktop basis.
#	- Cameron Simpson <cs@zip.com.au> 02feb2004
#

cmd=$0
usage="Usage: $cmd [-d desk] imagefile
	Default desk is the current desk.
	The desk \"-\" means the global default.
	The imagefile \"\" means remove the per desk setting for this desk."

desk=

badopts=

[ "x$1" = x-d ] && { desk=$2; shift; shift; }

if [ $# = 0 ]
then
    echo "$cmd: missing imagefile" >&2
    badopts=1
else
    imagefile=$1; shift
    [ $# = 0 ] || { echo "$cmd: extra arguments: $*" >&2; badopts=1; }
fi

[ $badopts ] && { echo "$usage" >&2; exit 2; }

perdesk=1
case "$desk" in
  ''|.)	desk=`currentdesk` || exit 1 ;;
  -)	desk= perdesk= ;;
esac

if [ -z "$imagefile" ]
then
    if [ $perdesk ]
    then desktop -r "$desk" rootbg
    else lastvalue "desk_dfltrootbg" ""
    fi
else
    rootbg=`mkwall "$imagefile"` || exit 1
    if [ $perdesk ]
    then desktop "$desk" rootbg "$rootbg"
    else lastvalue "desk_dfltrootbg" "$rootbg"
    fi
fi

exec syncrootbg
