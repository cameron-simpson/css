#!/bin/sh
#
# Operations to perform when entering a desktop.
#	- Cameron Simpson <cs@zip.com.au> 24mar2003
#

exec </dev/null
exec >>$HOME/var/log/console
exec 2>&1

thisdesk=$1
lastdesk=`currentdesk`

if [ "x$thisdesk" != "x$lastdesk" ]
then
    currentdesk "$thisdesk"

    desktop "$thisdesk" shcmds | sh -x &
    desktop "$thisdesk" wmcmds | fvwmcmd &

    if [ "x$XSESSIONMODE" != xvnc ]
    then
	# root backdrop
	Dflag=-D
	rootbg=`desktop "$thisdesk" rootbg`
	if [ -z "$rootbg" -o ! -s "$rootbg" ]
	then
	    Dflag=
	    rootbg=`lastvalue "defaultrootbg-$HOST"`
	fi

	if [ -n "$rootbg" -a -s "$rootbg" ]
	then
	  lastrootbg=`lastvalue rootbg`
	  [ "x$rootbg" != "x$lastrootbg" ] && rootbg $Dflag "$rootbg"
	else
	  fvwm-root --dummy
	  xsetroot -solid black
	fi &

    #    # menu backdrop
    #    Dflag=-D
    #    menubg=`desktop "$thisdesk" menubg`
    #    if [ -z "$menubg" -o ! -s "$menubg" ]
    #    then
    #	Dflag=
    #	menubg=`lastvalue "defaultmenubg-$HOST"`
    #    fi
    #
    #    if [ -n "$menubg" -a -s "$menubg" ]
    #    then
    #      lastmenubg=`lastvalue menubg`
    #      [ "x$menubg" != "x$lastmenubg" ] && menubg $Dflag "$menubg"
    #    else
    #      fvwm-root --dummy
    #      xsetroot -solid black
    #    fi

    fi &

    ( deskjob=`deskjob -d "$thisdesk"`
      case "$deskjob" in
	''|.|idle)	;;
	*)		job "$deskjob" ;;
      esac
    ) &
fi
