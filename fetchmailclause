#!/bin/sh
#
# Pull out a single clause from a .fetchmailrc file.
# The parsing's a little simplistic but it works fairly well.
#	- Cameron Simpson <cs@zip.com.au> 09sep2003
#

rc=$HOME/.fetchmailrc

cmd=$0
usage="Usage: $cmd [-f fetchmailrc] clause"

badopts=

[ "x$1" = x-f ] && { rc=$2; shift; shift; }

if [ $# = 0 ]
then  echo "$cmd: missing clause" >&2; badopts=1
else  clause=$1; shift
      [ $# = 0 ] || { echo "$cmd: extra arguments after clause: $*" >&2
		      badopts=1
		    }
fi

[ $badopts ] && { echo "$usage" >&2; exit 2; }

exec sed -e '
		y/	/ /
		s/   */ /g
		s/^ //
		s/ $//
		/^#/d
		/^$/d
	    '"	1,/^poll $clause\$/d
		/^poll/,\$d" "$rc"
