#!/bin/sh
#
# Permit ALL traffic to/from specified hosts (or "ALL").
#	- Cameron Simpson <cs@zip.com.au> 14jun2004
#

cmd=$0
usage="Usage: $cmd [+l] {ALL | hosts...}"

badopts=

chain_in=FW_INPUT
chain_out=FW_OUTPUT

dolog=1
[ "x$1" = x+l ] && { dolog=; shift; }

[ $badopts ] && { echo "$usage" >&2; exit 2; }

if [ "x$*" = xALL ]
then
    set -x
    iptables -I "$chain_in" -j ACCEPT
    iptables -I "$chain_out" -j ACCEPT
    [ $dolog ] && iptables -I "$chain_in" -p tcp --syn -j LOGACCEPT
    [ $dolog ] && iptables -I "$chain_out" -p tcp --syn -j LOGACCEPT
else
    set -x
    for host
    do
      iptables -I "$chain_in" -s "$host" -j ACCEPT
      iptables -I "$chain_out" -d "$host" -j ACCEPT
      [ $dolog ] && iptables -I "$chain_in" -s "$host" -p tcp --syn -j LOGACCEPT
      [ $dolog ] && iptables -I "$chain_out" -d "$host" -p tcp --syn -j LOGACCEPT
    done
fi
