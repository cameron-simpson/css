#!/bin/sh
#
# Get the daemonised ssh-agent info.
#	- Cameron Simpson <cs@zip.com.au> 30jul2001
#

cmd=$0
usage="Usage: $cmd [statefile]"

badopts=
statefile=
[ $# = 0 ] || { statefile=$1; shift; }
[ $# = 0 ] || { echo "$cmd: extra arguments: $*" >&2; badopts=1; }
[ $badopts ] && { echo "$usage" >&2; exit 2; }

have-ssh-agent -h -0 || exit 1

# protect against rogue output
exec 3>&1 1>/dev/null

[ -n "$statefile" ] || statefile=`ssh-agent-statefile` || exit 1

[ -s "$statefile" ] \
&& . "$statefile" \
&& have-ssh-agent -0 \
&& echo ". '$statefile'" >&3
