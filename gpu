#!/bin/sh
#
# Asynchronous getpageurls.	- Cameron Simpson <cs@zip.com.au>
#

cmd=$0

async=1
if [ "x$1" = x-s ]
then  shift; async=
fi

# hack to permit leading subdir prefix
case $1 in
    ''|-*|*://*)	;;
    *)		dirpfx=$1; shift
		if subdir=`mkdirn "$dirpfx/$dirpfx"`
		then
		    cd "$subdir" || exit 1
		fi
		colour_echo white "`pwd`"
		L
		;;
esac

if [ $# = 0 ]
then
  if [ -n "$DISPLAY" ]
  then
      set x "`cutbuffer`"; shift; echo "$1"
  else
      echo "$cmd: no \$DISPLAY or URL" >&2
      exit 1
  fi
fi

ulimit -d 16384	## 16M process data limit

tmp=${TMPDIR:-/tmp}/gpu$$
for arg
do  echo "$arg"
done >"$tmp"
exec <"$tmp"
cat "$tmp"
rm "$tmp"
set -x
set getpageurls -q $HOME/var/queue/httpgetd
[ $async ] || exec "$@"
exec bgstdin "$@"
