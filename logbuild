#!/bin/sh
#
# Run a new shell inside a script command, logging to the file
#	$HOME/var/log/build/pkg-arch-host-date.gz
# Too often was I building things and losing the details.
#	- Cameron Simpson <cs@zip.com.au> 28aug2000
#

cmd=`basename "$0"`
usage="Usage: $cmd pkgdir"

[ $# = 1 ] || { echo "$usage" >&2; exit 2; }
pkgdir=$1; shift

cd "$pkgdir" || { echo "$cmd: chdir($pkgdir) fails" >&2; exit 1; }

cwd=`pwd` || exit 1
pkg=`basename "$cwd"`

logbase=$pkg-$ARCH-$HOST

umask 2
session=$cmd-$pkg-$ARCH-$HOST
exec term -n "$session" \
    screen -S "$session" \
    buildenv env ps1pfx=":$ps1pfx" ps2pfx=" $ps2pfx" \
    logscript -d "${VARLOG:-$HOME/var/log}/build" "$logbase"
