#!/bin/sh
#
# Connect to default MySQL database.
#	- Cameron Simpson <cs@zip.com.au>
#

cmd=$0
usage="Usage: $cmd [-x] [@where] [dbname]"

PATH=$PATH:/usr/local/mysql/bin
export PATH

trace=
pfx=root
db=
where=

[ $# -gt 0 ] && [ "x$1" = x-x ] && { shift; trace-set-x; }

if [ $# -gt 0 ]
then
  case "$1" in
    @*)	where=$1; shift ;;
  esac
fi

[ $# = 0 ] || { db=$1; shift; }
[ $# = 0 ] || { echo "$usage" >&2; exit 2; }

if [ -n "$where" ]
then
  eval `secret "$pfx-mysql$where"` \
  || exit 1
else
  secret=`secret "$pfx-mysql@$HOST.$SYSTEMID"` \
  || secret=`secret "$pfx-mysql@$SYSTEMID"` \
  || exit 1
  eval "$secret" || exit 1
fi

exec $trace mysql "-h$secretHOST" "-u$secretLOGIN" "-p$secretPASSWORD" $db
