BaseCommand: big refactor of subcommand internals and make the "cmd_foo=FooCommand" implementation work properly.
