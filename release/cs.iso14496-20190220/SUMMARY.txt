parse_buffer yields instead of returns; some small bugfixes.
