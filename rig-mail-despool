#!/bin/sh -u

cmd=`basename "$0"`

: ${MAILDIR:=$HOME/mail}

lock=mail-io
delay=5

[ $# -gt 0 ] || set -- spool spool-in spool-out spool-xref ham spam-definite

## OBSOLETE ## bgproc -l procmail -p mail-despam -- set-x lock -1 "$MAILDIR/spool" mail-despam -d "$delay" -l "$lock" +spool +spool-in

xit=0

for spool
do
  maildir=$MAILDIR/$spool
  if locked "$maildir"
  then
    echo "$cmd: lock $maildir already taken" >&2
    xit=1
    continue
  fi

  bgproc -l procmail -p "mail-$spool" -- set-x lock -1 "$maildir" mail-despool -d "$delay" "$maildir"
done

exit $xit
