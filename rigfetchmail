#!/bin/sh
#
# Dispatch a daemon mode fetchmail.
#	- Cameron Simpson <cs@zip.com.au> 14dec2003
#

: ${LOGDIR:=$HOME/var/log}

needhost $HOMEHOST@home || exit 1
set -x
cd
( fmopts=
  fmdelay=600
  fmhosts='127.0.0.2 127.0.0.3'
  case "$LOCATION" in
    home|sco|tw)
	fmopts="$fmopts -l 65536" fmdelay=1800 ;;
  esac
  set -- -f "$HOME/.fetchmailrc" \
	  -t 900 \
	  --logfile "$LOGDIR/fetchmail" \
	  --nobounce --tracepolls --warnings 86400
  ( fetchmail "$@" -l 65536 $fmopts $fmhosts
    sleep 60
    acon fetchmail "$@" -d "$fmdelay" $fmopts $fmhosts
  ) &
)
alog procmail lock -1 getmail-despool nice getmail-flush -p 300 spool
