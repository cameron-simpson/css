#!/bin/sh -u
#
# Kick of a port forward ssh.
#	- Cameron Simpson <cs@zip.com.au> 18jan2006
#

uid=`id -u` || exit 1
if [ "x$uid" != x0 ]
then
  shcmd=". /opt/css/env.sh; "`shqstr "$0" ${1+"$@"}`
  set -x
  exec sudo sh -c "$shcmd"
fi

: ${VARRUN:=$HOME/var/run}

cf=$HOME/rc/ssh/config-pf
delay=120

[ $# -gt 0 ] || set -- $SSHPF_DFLT

pidfile=$VARRUN/sshpf.pid

set -x
killpidfile -w "$pidfile"
>"$pidfile"
for host
do
  sshb -n -F "$cf" "$host" "while echo .; do sleep $delay; done" 1>/dev/null &
  echo $! >>"$pidfile"
done
sleep 2
